<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mali MÃ¼ÅŸavir Paneli</title>
    <link rel="stylesheet" href="style.css">
    <meta name="theme-color" content="#2c3e50">
    <link rel="manifest" href="/suttakip/manifest.json">
    <link rel="icon" href="https://raw.githubusercontent.com/sozcelyk43/suttakip/refs/heads/main/favicon.ico" type="image/x-icon" />
</head>
<body class="full-width-page">
<div class="main-content">
    <section id="mustahsil-merkezi" class="module-section">
        <div class="module-header">
    	<h2>ðŸ’¼ Mali MÃ¼ÅŸavir Paneli</h2>
   	<div class="module-switcher">
    	<label for="moduleSwitchSelect">Panel DeÄŸiÅŸtir</label>
    	<select id="moduleSwitchSelect">
        <option value="index.html">ðŸ“’ Hesap Defteri</option>
        <option value="mustahsil.html" selected>ðŸ’¼ Mali MÃ¼ÅŸavir Paneli</option>
    </select>
</div>
    <div class="header-logout">
    <a href="#" id="logoutButton">
        <div>ðŸšª Ã‡Ä±kÄ±ÅŸ Yap</div>
        <div id="logoutUserEmail" class="logout-email-subtext"></div>
    </a>
</div>
</div>
        <div class="container">
            <div class="form-section">
                <div class="form-grid" style="grid-template-columns: 1fr 1fr 1fr auto; align-items: end; gap: 15px;">
                    <div class="form-group">
                        <label for="mm-batch-baslangic">DÃ¶nem BaÅŸlangÄ±Ã§:</label>
                        <input type="date" id="mm-batch-baslangic" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="mm-batch-bitis">DÃ¶nem BitiÅŸ:</label>
                        <input type="date" id="mm-batch-bitis" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="mm-batch-kategori">Kategori/KÃ¶y:</label>
                        <select id="mm-batch-kategori" class="form-control">
                            <option value="">TÃ¼m Kategoriler</option>
                        </select>
                    </div>
                    <button id="mm-batch-getir-btn" class="btn btn-primary" style="height: 45px;">Verileri Getir</button>
                </div>
            </div>

            <div id="mm-batch-sonuc-alani" class="list-section" style="margin-top:20px; display:none;">
                <div class="table-wrapper" style="overflow-x: auto;">
                    <table id="mm-batch-table" class="report-table">
                        <thead>
                            <tr>
                                <th style="width: 20px;"><input type="checkbox" id="mm-batch-select-all"></th>
                                <th>MÃ¼stahsil AdÄ±</th>
                                <th>Toplam SÃ¼t (LT)</th>
                                <th>Birim Fiyat (â‚º)</th>
                                <th>BrÃ¼t Tutar (â‚º)</th>
                                <th>Stopaj (%2)</th>
                                <th>SGK Kesintisi (%2)</th>
                                <th>Net Tutar (â‚º)</th>
                                <th>Durum</th>
                            </tr>
                        </thead>
                        <tbody id="mm-batch-table-body"></tbody>
                    </table>
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #f8f9fa; margin-top: 10px; border-radius: 5px;">
                    <div><strong>SeÃ§ilen KayÄ±t SayÄ±sÄ±:</strong> <span id="mm-batch-secilen-sayi">0</span></div>
                    <div><strong>SeÃ§ilenlerin Toplam Net Tutar:</strong> <span id="mm-batch-toplam-tutar" style="font-size: 1.2em;">0,00 â‚º</span></div>
                    <div>
                        <button id="mm-batch-iptal-btn" class="btn">Ä°ptal Et / Geri DÃ¶n</button>
                        <button id="mm-batch-gonder-btn" class="btn btn-success">SeÃ§ilenler iÃ§in Makbuz OluÅŸtur</button>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div> 

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
    import { getFirestore, collection, doc, getDoc, getDocs, query, where, orderBy } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
    
    const firebaseConfig = {
        apiKey: "AIzaSyCWG4nFwpXRffr_3MO8-Us9mWK6Wsfn0mY",
        authDomain: "sut-takip-projem.firebaseapp.com",
        projectId: "sut-takip-projem",
        storageBucket: "sut-takip-projem.appspot.com",
        messagingSenderId: "512756958486",
        appId: "1:512756958486:web:13cceb6835e2c575e9fc37",
        measurementId: "G-LYLT9WFVNK"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let sahipId = '';
    let globalSettings = {};
    window.cariDataMap = new Map();

    onAuthStateChanged(auth, async (user) => {
        if (user) {
            const logoutUserEmailEl = document.getElementById('logoutUserEmail');
            if(logoutUserEmailEl) logoutUserEmailEl.textContent = user.email;

            try {
                const userDocRef = doc(db, 'kullanicilar', user.uid);
                const userDocSnap = await getDoc(userDocRef);
                if (userDocSnap.exists()) {
                    const userData = userDocSnap.data();
                    sahipId = userData.sahipId || user.uid;
                    if (userData.rol !== 'admin') {
                        window.location.href = 'index.html';
                        return;
                    }
                    await getSettings();
                    await loadInitialData();
                    uygulamayiBaslat_Mustahsil();
                } else {
                    handleLogout();
                }
            } catch (error) {
                console.error("GiriÅŸ sÄ±rasÄ±nda hata:", error);
                handleLogout();
            }
        } else {
            window.location.href = 'login.html';
        }
    });

   

function uygulamayiBaslat_Mustahsil() {
    document.getElementById('logoutButton')?.addEventListener('click', handleLogout);
    document.getElementById('mm-batch-getir-btn')?.addEventListener('click', renderBatchOnayEkrani);
    document.getElementById('mm-batch-gonder-btn')?.addEventListener('click', handleBatchMakbuzGonder);
    document.getElementById('mm-batch-select-all')?.addEventListener('change', (e) => {
        document.querySelectorAll('.mm-batch-checkbox').forEach(cb => cb.checked = e.target.checked);
        updateBatchTotals();
    });
    document.getElementById('mm-batch-iptal-btn')?.addEventListener('click', () => {
        const sonucAlani = document.getElementById('mm-batch-sonuc-alani');
        if(sonucAlani) sonucAlani.style.display = 'none';
    });
    document.getElementById('moduleSwitchSelect')?.addEventListener('change', function() {
        if (this.value) window.location.href = this.value;
    });

   const formatForInput = (date) => {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0'); // +1 Ã§Ã¼nkÃ¼ aylar 0'dan baÅŸlar
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    };
    
    const baslangicInput = document.getElementById('mm-batch-baslangic');
    const bitisInput = document.getElementById('mm-batch-bitis');
    const today = new Date(); // Åžu anki yerel tarih
    const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1); // Ä°Ã§inde bulunulan ayÄ±n ilk gÃ¼nÃ¼
    
    baslangicInput.value = formatForInput(firstDayOfMonth);
    bitisInput.value = formatForInput(today);
    populateCariKategoriSelect(document.getElementById('mm-batch-kategori'), "TÃ¼m Kategoriler");
}

async function getSettings() {
        if (!sahipId) return;
        const settingsRef = doc(db, 'ayarlar', sahipId);
        try {
            const docSnap = await getDoc(settingsRef);
            globalSettings = docSnap.exists() ? docSnap.data() : {};
        } catch(e) { console.error("Ayarlar alÄ±nÄ±rken hata: ", e); }
    }

async function loadInitialData() {
        if (!sahipId) return;
        try {
            const carilerQuery = query(collection(db, 'cariler'), where("sahipId", "==", sahipId));
            const carilerSnapshot = await getDocs(carilerQuery);
            window.cariDataMap.clear();
            carilerSnapshot.forEach(doc => {
                window.cariDataMap.set(doc.id, doc.data());
            });
        } catch (error) { console.error("BaÅŸlangÄ±Ã§ verileri (Cariler) yÃ¼klenirken hata:", error); }
    }
	
async function renderBatchOnayEkrani() {
        const baslangic = document.getElementById('mm-batch-baslangic').value;
        const bitis = document.getElementById('mm-batch-bitis').value;
        const kategori = document.getElementById('mm-batch-kategori').value;
        const tableBody = document.getElementById('mm-batch-table-body');
        const sonucAlani = document.getElementById('mm-batch-sonuc-alani');

        if (!baslangic || !bitis) return showToast("LÃ¼tfen dÃ¶nem baÅŸlangÄ±Ã§ ve bitiÅŸ tarihlerini seÃ§in.", true);
        
        tableBody.innerHTML = `<tr><td colspan="9" style="text-align:center; padding:20px;">Veriler yÃ¼kleniyor...</td></tr>`;
        sonucAlani.style.display = 'block';
        updateBatchTotals();

        try {
            const sutQuery = query(collection(db, 'sut_alimlari'), where('sahipId', '==', sahipId), where('tarih', '>=', baslangic), where('tarih', '<=', bitis));
            const carilerQuery = kategori 
                ? query(collection(db, 'cariler'), where("sahipId", "==", sahipId), where("kategori", "==", kategori))
                : query(collection(db, 'cariler'), where("sahipId", "==", sahipId));

            const [sutSnap, carilerSnap] = await Promise.all([getDocs(sutQuery), getDocs(carilerQuery)]);
            const cariMap = new Map(carilerSnap.docs.map(doc => [doc.id, doc.data()]));
            const mustahsilVerileri = new Map();

            sutSnap.forEach(doc => {
                const alim = doc.data();
                if (!cariMap.has(alim.cariId)) return;
                if (!mustahsilVerileri.has(alim.cariId)) {
                    mustahsilVerileri.set(alim.cariId, { toplamSut: 0, brutTutar: 0 });
                }
                const mustahsil = mustahsilVerileri.get(alim.cariId);
                mustahsil.toplamSut += alim.toplam || 0;
                mustahsil.brutTutar += alim.toplamTutar || 0;
            });

            if (mustahsilVerileri.size === 0) {
                 tableBody.innerHTML = `<tr><td colspan="9" style="text-align:center; padding:20px;">Bu dÃ¶nemde ve kategoride veri bulunamadÄ±.</td></tr>`;
                 return;
            }

            let tableHTML = '';
            mustahsilVerileri.forEach((data, cariId) => {
                const cariData = cariMap.get(cariId);
                if (!cariData) return;
                const birimFiyat = data.toplamSut > 0 ? data.brutTutar / data.toplamSut : 0;
const kesintiler = calculateDeductions(data.brutTutar, cariData.eMustahsilParams);
                tableHTML += `<tr data-cari-id="${cariId}" data-cari-adi="${cariData.adiSoyadi}"><td><input type="checkbox" class="mm-batch-checkbox" onchange="updateBatchTotals()"></td><td>${cariData.adiSoyadi}</td><td class="data-sut">${data.toplamSut.toFixed(2)}</td><td class="data-fiyat">${birimFiyat.toFixed(2)}</td><td class="data-brut">${data.brutTutar.toFixed(2)}</td><td class="data-stopaj">${kesintiler.gelirVergisiTevkifati.toFixed(2)}</td><td class="data-sgk">${kesintiler.sgkTevkifati.toFixed(2)}</td><td class="data-net" style="font-weight:bold;">${kesintiler.netTutar.toFixed(2)}</td><td><span class="badge badge-pending">Bekliyor</span></td></tr>`;
            });
            tableBody.innerHTML = tableHTML;
        } catch (error) {
            console.error("Toplu mÃ¼stahsil verisi getirilirken hata:", error);
            tableBody.innerHTML = `<tr><td colspan="9" style="text-align:center; color:red;">Hata oluÅŸtu!</td></tr>`;
        }
    }

function updateBatchTotals() {
        const allCheckboxes = document.querySelectorAll('.mm-batch-checkbox');
        let secilenSayi = 0;
        let toplamTutar = 0;
        allCheckboxes.forEach(cb => {
            if (cb.checked) {
                secilenSayi++;
                const netTutar = parseFloat(cb.closest('tr').querySelector('.data-net').textContent) || 0;
                toplamTutar += netTutar;
            }
        });
        document.getElementById('mm-batch-secilen-sayi').textContent = secilenSayi;
        document.getElementById('mm-batch-toplam-tutar').textContent = formatCurrency(toplamTutar);
    }
    window.updateBatchTotals = updateBatchTotals;

    async function handleBatchMakbuzGonder() {
        const secilenSatirlar = document.querySelectorAll('.mm-batch-checkbox:checked');
        if (secilenSatirlar.length === 0) return showToast("LÃ¼tfen en az bir mÃ¼stahsil seÃ§in.", true);

        const onayMesaji = `${secilenSatirlar.length} adet mÃ¼stahsil iÃ§in makbuz oluÅŸturulacak. Bu iÅŸlem, tarayÄ±cÄ±nÄ±zda yeni sekmeler aÃ§acaktÄ±r. Devam etmek istiyor musunuz?`;
        
        showCustomConfirm(onayMesaji, () => {
            showToast(`${secilenSatirlar.length} adet makbuz oluÅŸturuluyor...`, false, 3000);
            secilenSatirlar.forEach((cb) => {
                const satir = cb.closest('tr');
                const durumHucre = satir.querySelector('td:last-child .badge');
                const makbuzPenceresi = window.open('', '_blank');

                if (!makbuzPenceresi) {
                    showToast("Pop-up engelleyici aktif olabilir. LÃ¼tfen izin verin.", true);
                    if(durumHucre) { durumHucre.textContent = 'Engellendi'; durumHucre.className = 'badge badge-danger'; }
                    return;
                }
                makbuzPenceresi.document.write('<body>Makbuz iÃ§eriÄŸi hazÄ±rlanÄ±yor...</body>');

                try {
                    const veri = { cariId: satir.dataset.cariId, cariAdi: satir.dataset.cariAdi, brutTutar: parseFloat(satir.querySelector('.data-brut').textContent) };
                    handleMakbuzOlustur(veri, makbuzPenceresi);
                    if(durumHucre) { durumHucre.textContent = 'OluÅŸturuldu'; durumHucre.className = 'badge badge-success'; }
                } catch (e) {
                    if(durumHucre) { durumHucre.textContent = 'Hata'; durumHucre.className = 'badge badge-danger'; }
                    makbuzPenceresi.document.write(`<body>Bir hata oluÅŸtu: ${e.message}</body>`);
                    makbuzPenceresi.document.close();
                    console.error("Makbuz oluÅŸturulurken hata:", e);
                }
            });
        }, "Toplu Makbuz OnayÄ±");
    }

function handleMakbuzOlustur(veri, makbuzPenceresi) {
        try {
            const { cariId, cariAdi, brutTutar } = veri;
            if (!globalSettings.firmaProfili || !globalSettings.firmaProfili.unvan) throw new Error("LÃ¼tfen Ayarlar menÃ¼sÃ¼nden firma bilgilerinizi doldurun.");
            
            const aliciData = globalSettings.firmaProfili;
            const saticiData = window.cariDataMap.get(cariId);
            if (!saticiData) throw new Error(`${cariAdi} iÃ§in cari verisi bulunamadÄ±.`);

            const belgeNo = `MM-${cariId.substring(0, 4)}-${Date.now()}`;
            const kesintiler = calculateDeductions(brutTutar);
            let makbuzHTML = getMakbuzHTMLTemplate();

            makbuzHTML = makbuzHTML.replace(/__ALICI_UNVAN__/g, aliciData.unvan || '').replace('__ALICI_ADRES__', aliciData.adres || '').replace('__ALICI_VERGI_DAIRESI__', aliciData.vergiDairesi || '').replace('__ALICI_VKN__', aliciData.vkn || '').replace('__ALICI_TELEFON__', aliciData.telefon || '').replace('__SATICI_ADI__', cariAdi).replace('__SATICI_TC__', saticiData.vergiNo || 'BelirtilmemiÅŸ').replace('__SATICI_ADRES__', saticiData.adres || 'BelirtilmemiÅŸ').replace('__BELGE_NO__', belgeNo).replace('__DUZENLEME_TARIHI__', new Date().toLocaleDateString('tr-TR')).replace('__BRUT_TUTAR__', formatCurrency(kesintiler.brutTutar)).replace('__GELIR_VERGISI__', formatCurrency(kesintiler.gelirVergisiTevkifati)).replace('__SGK_TEVKIFATI__', formatCurrency(kesintiler.sgkTevkifati)).replace('__BORSA_TESCIL__', formatCurrency(kesintiler.borsaTescilUcreti)).replace('__TOPLAM_KESINTI__', formatCurrency(kesintiler.toplamKesinti)).replace('__ODENECEK_NET_TUTAR__', formatCurrency(kesintiler.netTutar)).replace('__YAZI_ILE_TUTAR__', numberToWordsTR(kesintiler.netTutar));
            const kalemlerHTML = `<tr><td>1</td><td>DÃ¶nem Toplam SÃ¼t Bedeli</td><td class="text-right"></td><td></td><td class="text-right"></td><td class="text-right">${formatCurrency(kesintiler.brutTutar)}</td></tr>`;
            makbuzHTML = makbuzHTML.replace('__KALEMLER_GOVDESI__', kalemlerHTML);

            if (makbuzPenceresi && !makbuzPenceresi.closed) {
                makbuzPenceresi.document.open();
                makbuzPenceresi.document.write(makbuzHTML);
                makbuzPenceresi.document.close();
            } else { throw new Error("Makbuz penceresi bulunamadÄ± veya kapatÄ±ldÄ±."); }
        } catch (error) {
            console.error("handleMakbuzOlustur iÃ§inde hata:", error);
            if (makbuzPenceresi && !makbuzPenceresi.closed) {
                makbuzPenceresi.document.body.innerHTML = `Bir hata oluÅŸtu: ${error.message}`;
            }
            throw error;
        }
    }
    
function handleLogout() {signOut(auth).then(() => { window.location.href = 'login.html'; }).catch(error => console.error("Logout error", error));}

async function populateCariKategoriSelect(selectElement, defaultOptionText = "SeÃ§iniz...") {
        if(!selectElement) return;
        try {
            const q = query(collection(db, 'cari_kategorileri'), where("sahipId", "==", sahipId), orderBy('ad'));
            const snapshot = await getDocs(q);
            const kategoriler = snapshot.docs.map(doc => doc.data());
            selectElement.innerHTML = `<option value="">${defaultOptionText}</option>`;
            kategoriler.forEach(kat => {
                const option = document.createElement('option');
                option.value = kat.ad;
                option.textContent = kat.ad;
                selectElement.appendChild(option);
            });
        } catch(error) { console.error("Kategori seÃ§imi yÃ¼klenirken hata:", error); }
    }

function showToast(message, isError = false) {
        const toastContainer = document.body;
        const toast = document.createElement('div');
        toast.id = 'toast-message';
        toast.className = 'toast-message';
        toast.textContent = message;
        toast.style.backgroundColor = isError ? '#e74c3c' : '#28a745';
        toastContainer.appendChild(toast);
        setTimeout(() => toast.classList.add('show'), 10);
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => toast.remove(), 500);
        }, 3000);
    }

function showCustomConfirm(message, onConfirm, title = "Ä°ÅŸlem OnayÄ±") {
        let overlay = document.getElementById('custom-confirm-overlay');
        if (!overlay) {
            overlay = document.createElement('div');
            overlay.id = 'custom-confirm-overlay';
            overlay.className = 'custom-modal-overlay';
            overlay.innerHTML = `<div class="custom-modal-box"><h3 id="custom-confirm-title"></h3><p id="custom-confirm-message"></p><div class="custom-modal-buttons"><button id="custom-confirm-cancel" class="btn">HayÄ±r</button><button id="custom-confirm-yes" class="btn btn-danger">Evet</button></div></div>`;
            document.body.appendChild(overlay);
        }
        
        const yesBtn = document.getElementById('custom-confirm-yes');
        const cancelBtn = document.getElementById('custom-confirm-cancel');
        document.getElementById('custom-confirm-title').textContent = title;
        document.getElementById('custom-confirm-message').textContent = message;
        
        const cleanupAndConfirm = () => { onConfirm(); overlay.classList.remove('show'); };
        const cleanupAndCancel = () => { overlay.classList.remove('show'); };
        
        yesBtn.onclick = cleanupAndConfirm;
        cancelBtn.onclick = cleanupAndCancel;
        overlay.classList.add('show');
    }

function formatCurrency(number) { return new Intl.NumberFormat('tr-TR', { style: 'currency', currency: 'TRY' }).format(number || 0); }

function calculateDeductions(brutTutar, params = {}) {
    const p = {
        borsaTesciliVar: params.borsaTesciliVar || false,
        sgkKesintisiUygula: params.sgkKesintisiUygula !== false, 
        stopajOrani: params.stopajOrani || 4, 
        borsaTescilOrani: params.borsaTescilOrani || 0.1 
    };

    const gelirVergisiOrani = p.stopajOrani / 100;
    const sgkOrani = p.sgkKesintisiUygula ? 0.02 : 0; 
    const borsaOrani = p.borsaTesciliVar ? (p.borsaTescilOrani / 100) : 0;

    const gelirVergisiTevkifati = brutTutar * gelirVergisiOrani;
    const sgkTevkifati = brutTutar * sgkOrani;
    const borsaTescilUcreti = brutTutar * borsaOrani;

    const toplamKesinti = gelirVergisiTevkifati + sgkTevkifati + borsaTescilUcreti;
    const netTutar = brutTutar - toplamKesinti;

    return { brutTutar, gelirVergisiTevkifati, sgkTevkifati, borsaTescilUcreti, toplamKesinti, netTutar };
}

function numberToWordsTR(num) {
        const [tamKisim, ondalikKisim] = String((num || 0).toFixed(2)).split('.');
        return `${tamKisim} TL ${ondalikKisim} KrÅŸ.`;
    }

function getMakbuzHTMLTemplate() {
    return `
    <!DOCTYPE html>
    <html lang="tr">
    <head>
        <meta charset="UTF-8">
        <title>e-MÃ¼stahsil Makbuzu</title>
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
            
            /* A4 SAYFA AYARLARI */
            @page {
                size: A4 portrait;
                margin: 1.5cm; /* Kenar boÅŸluklarÄ± */
            }

            body { 
                font-family: 'Roboto', Arial, sans-serif; 
                font-size: 9pt; /* Ana yazÄ± boyutu */
                color: #333; 
                -webkit-print-color-adjust: exact; /* Arka plan renklerini yazdÄ±rmayÄ± zorla */
            }

            .makbuz-container { width: 100%; height: 100%; }
            .makbuz-header { display: flex; justify-content: space-between; align-items: flex-start; border-bottom: 2px solid #000; padding-bottom: 8px; }
            .makbuz-title h1 { margin: 0; font-size: 18pt; color: #000; letter-spacing: -1px;} /* Boyut ayarlandÄ± */
            .makbuz-title p { margin: 4px 0 0; font-size: 10pt; color: #555; }
            
            .belge-info { text-align: right; }
            .belge-info p { margin: 2px 0; font-size: 9pt;} /* Boyut ayarlandÄ± */
            
            .party-info { display: flex; justify-content: space-between; margin-top: 12px; padding-bottom:12px; border-bottom: 1px solid #ccc; }
            .party { width: 48.5%; border: 1px solid #ccc; padding: 8px; border-radius: 5px; } /* BoÅŸluklar ayarlandÄ± */
            .party h3 { background-color: #f2f2f2; padding: 6px; margin: -8px -8px 8px -8px; font-size: 10pt; border-bottom: 1px solid #ccc; border-radius: 5px 5px 0 0; } /* BoÅŸluklar ayarlandÄ± */
            .party p { margin: 3px 0; line-height: 1.3; font-size: 8.5pt;} /* Boyut ve satÄ±r yÃ¼ksekliÄŸi ayarlandÄ± */
            
            .line-items-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
            .line-items-table th, .line-items-table td { border: 1px solid #999; padding: 5px 6px; text-align: left; } /* BoÅŸluklar ayarlandÄ± */
            .line-items-table th { background-color: #e9ecef; font-weight: 500; }
            
            .totals-section { display: flex; justify-content: flex-end; margin-top: 12px; }
            .totals-table { width: 50%; border-spacing: 0; }
            .totals-table td { padding: 4px 6px; font-size: 9pt; } /* BoÅŸluklar ayarlandÄ± */
            .totals-table tr td:first-child { text-align: right; font-weight: 500; }
            .totals-table .kesinti-row td:first-child { color: #d9534f; }
            
            .net-tutar-row { font-weight: bold; background-color: #e9ecef; border-top: 2px solid #000; font-size: 11pt; } /* Boyut ayarlandÄ± */
            
            .makbuz-footer { margin-top: 25px; font-size: 8pt; border-top: 1px solid #ccc; padding-top: 10px; }
            .text-right { text-align: right !important; }
        </style>
    </head>
    <body>
        <div class="makbuz-container">
            <div class="makbuz-header">
                <div class="makbuz-title"><h1>MÃœSTAHSÄ°L MAKBUZU</h1><p>__ALICI_UNVAN__</p></div>
                <div class="belge-info"><p><strong>Belge No:</strong> __BELGE_NO__</p><p><strong>Tarih:</strong> __DUZENLEME_TARIHI__</p></div>
            </div>
            <div class="party-info">
                <div class="party"><h3>ALICI</h3><p><strong>Unvan:</strong> __ALICI_UNVAN__</p><p><strong>Adres:</strong> __ALICI_ADRES__</p><p><strong>V.D./VKN:</strong> __ALICI_VERGI_DAIRESI__ / __ALICI_VKN__</p><p><strong>Tel:</strong> __ALICI_TELEFON__</p></div>
                <div class="party"><h3>SATICI (MÃœSTAHSÄ°L)</h3><p><strong>AdÄ± SoyadÄ±:</strong> __SATICI_ADI__</p><p><strong>Adres:</strong> __SATICI_ADRES__</p><p><strong>V.D./TCKN:</strong> __SATICI_TC__</p></div>
            </div>
            <table class="line-items-table">
                <thead><tr><th>#</th><th>AÃ§Ä±klama</th><th class="text-right">Miktar</th><th>Birim</th><th class="text-right">Birim Fiyat</th><th class="text-right">Tutar (TL)</th></tr></thead>
                <tbody id="kalemler-govdesi">__KALEMLER_GOVDESI__</tbody>
            </table>
            <div class="totals-section">
                <table class="totals-table">
                    <tr><td>Mal Hizmet Toplam TutarÄ± (BrÃ¼t)</td><td class="text-right">__BRUT_TUTAR__</td></tr>
                    <tr class="kesinti-row"><td>Gelir Vergisi TevkifatÄ± (%2)</td><td class="text-right">(-) __GELIR_VERGISI__</td></tr>
                    <tr class="kesinti-row"><td>SGK TevkifatÄ± (%2)</td><td class="text-right">(-) __SGK_TEVKIFATI__</td></tr>
                    <tr class="kesinti-row"><td>Borsa Tescil Ãœcreti (%0.2)</td><td class="text-right">(-) __BORSA_TESCIL__</td></tr>
                    <tr><td><strong>Toplam Kesinti</strong></td><td class="text-right"><strong>(-) __TOPLAM_KESINTI__</strong></td></tr>
                    <tr class="net-tutar-row"><td>Ã–DENECEK NET TUTAR</td><td class="text-right">__ODENECEK_NET_TUTAR__</td></tr>
                </table>
            </div>
            <div class="makbuz-footer"><p><strong>YalnÄ±z:</strong> __YAZI_ILE_TUTAR__</p></div>
        </div>
    </body>
    </html>`;
}
</script>

<div id="toast-message" class="toast-message"></div>
<div id="custom-confirm-overlay" class="custom-modal-overlay">
    <div class="custom-modal-box">
        <h3 id="custom-confirm-title">Ä°ÅŸlem OnayÄ±</h3>
        <p id="custom-confirm-message">Bu iÅŸlemi yapmak istediÄŸinizden emin misiniz?</p>
        <div class="custom-modal-buttons">
            <button id="custom-confirm-cancel" class="btn">HayÄ±r</button>
            <button id="custom-confirm-yes" class="btn btn-danger">Evet</button>
        </div>
    </div>
</div>

</body>
</html>